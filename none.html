<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Batch File Renamer and Zipper</title>
    <style>
        /* [Your existing CSS remains unchanged] */
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 25px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        #drop-area {
            border: 2px dashed #ffa500;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            color: #ffa500;
            margin-bottom: 20px;
            transition: border-color 0.3s, background-color 0.3s;
            background-color: #fff8e1;
            overflow-y: auto;
            max-height: 300px;
        }
        #drop-area.highlight {
            border-color: #ff8c00;
            background-color: #ffe0b2;
            color: #333;
        }
        #file-list {
            margin-top: 20px;
            text-align: left;
            max-height: 180px;
            overflow-y: auto;
        }
        #file-list p {
            margin: 0;
            padding: 5px 0;
            border-bottom: 1px solid #ccc;
        }
        #file-input {
            display: none;
        }
        .button {
            display: inline-block;
            padding: 12px 25px;
            background-color: #ffa500;
            color: #fff;
            text-decoration: none;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #ff8c00;
        }
        .button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #progress {
            margin-top: 20px;
            display: none;
        }
        #progress span {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }
        #uploaded-folder-name {
            margin-bottom: 15px;
            font-weight: bold;
            color: #333;
        }
        #warning-message {
            color: red;
            margin-bottom: 15px;
            display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Batch File Renamer and Zipper</h1>
    
    <div class="input-group">
        <label for="creator">Creator Name:</label>
        <input type="text" id="creator" placeholder="Enter creator name">
    </div>
    
    <div class="input-group">
        <label for="event">Event:</label>
        <input type="text" id="event" placeholder="Enter event name">
    </div>
    
    <div class="input-group">
        <label for="date">Date:</label>
        <input type="text" id="date" placeholder="Enter date (e.g., 2024-04-27)">
    </div>
    
    <div class="input-group">
        <label for="misc">Misc:</label>
        <input type="text" id="misc" placeholder="Enter any miscellaneous info">
    </div>
    
    <div id="warning-message">At least one field must be filled in.</div>
    
    <div id="uploaded-folder-name"></div>
    
    <div id="drop-area">
        <p>Drag and drop your files here</p>
        <p>or</p>
        <button class="button" id="upload-button">Select Files</button>
        <input type="file" id="file-input" multiple>
        <div id="file-list"></div>
    </div>
    
    <button class="button" id="process-button" disabled>Rename and Download ZIP</button>
    <button class="button" id="reset-button">Reset</button>
    
    <div id="progress">
        <span id="status">Preparing files...</span>
    </div>
</div>

<!-- Include JSZip from CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"></script>
<!-- Include FileSaver from CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
    const uploadButton = document.getElementById('upload-button');
    const fileInput = document.getElementById('file-input');
    const dropArea = document.getElementById('drop-area');
    const processButton = document.getElementById('process-button');
    const resetButton = document.getElementById('reset-button');
    const progressDiv = document.getElementById('progress');
    const statusSpan = document.getElementById('status');
    const uploadedFolderNameDiv = document.getElementById('uploaded-folder-name');
    const warningMessage = document.getElementById('warning-message');
    const fileList = document.getElementById('file-list');

    let files = [];
    let folderName = "renamed_files";

    // Prevent default behaviors for drag-and-drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults (e) {
        e.preventDefault();
        e.stopPropagation();
    }

    // Highlight drop area when item is dragged over it
    ['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
        dropArea.classList.add('highlight');
    }

    function unhighlight(e) {
        dropArea.classList.remove('highlight');
    }

    // Handle dropped files and folders
    dropArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const selectedFiles = dt.files;

        if (selectedFiles.length > 0) {
            files = Array.from(selectedFiles);
            processButton.disabled = false;
            displayFiles(files);
            folderName = "renamed_files"; // Default folder name since directory structure isn't available
            updateUploadedFolderName();
        } else {
            files = [];
            processButton.disabled = true;
            uploadedFolderNameDiv.textContent = "";
        }
    }

    // Handle file selection via button
    uploadButton.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', () => {
        handleFiles(fileInput.files);
    });

    function handleFiles(selectedFiles) {
        files = Array.from(selectedFiles);
        if (files.length > 0) {
            processButton.disabled = false;
            displayFiles(files);
            folderName = "renamed_files"; // Default folder name since directory structure isn't available
            updateUploadedFolderName();
        } else {
            processButton.disabled = true;
            uploadedFolderNameDiv.textContent = "";
        }
    }

    function updateUploadedFolderName() {
        if (folderName) {
            uploadedFolderNameDiv.textContent = `Uploaded Folder: ${folderName}`;
        } else {
            uploadedFolderNameDiv.textContent = "";
        }
    }

    // Display file list in the drop area
    function displayFiles(files) {
        fileList.innerHTML = "";
        files.forEach(file => {
            const p = document.createElement('p');
            p.textContent = file.name;
            fileList.appendChild(p);
        });
    }

    processButton.addEventListener('click', async () => {
        const creator = document.getElementById('creator').value.trim();
        const eventInput = document.getElementById('event').value.trim();
        const date = document.getElementById('date').value.trim();
        const misc = document.getElementById('misc').value.trim();

        if (!creator && !eventInput && !date && !misc) {
            warningMessage.style.display = 'block';
            setTimeout(() => {
                warningMessage.style.display = 'none';
            }, 3000);
            return;
        }

        processButton.disabled = true;
        uploadButton.disabled = true;
        fileInput.disabled = true;
        resetButton.disabled = true;
        progressDiv.style.display = 'block';
        statusSpan.textContent = 'Processing files...';

        const zip = new JSZip();
        let zipFolderName = constructFolderName(creator, eventInput, date, misc);
        if (!zipFolderName) {
            zipFolderName = "renamed_files";
        }
        const folder = zip.folder(zipFolderName);

        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const seqNumber = i + 1;
            const lastDot = file.name.lastIndexOf('.');
            let extension = '';
            if (lastDot !== -1) {
                extension = file.name.substring(lastDot);
            }
            const newName = constructFileName(creator, eventInput, date, misc, seqNumber, extension);
            try {
                const fileData = await file.arrayBuffer();
                folder.file(newName, fileData);
                statusSpan.textContent = `Processed ${i + 1} of ${files.length} files...`;
            } catch (error) {
                console.error(`Error processing file ${file.name}:`, error);
                alert(`Error processing file ${file.name}. See console for details.`);
                resetUI();
                return;
            }
        }

        try {
            statusSpan.textContent = 'Generating ZIP file...';
            const zipBlob = await zip.generateAsync({type: "blob"}, (metadata) => {
                statusSpan.textContent = `Generating ZIP: ${Math.floor(metadata.percent)}% completed`;
            });
            saveAs(zipBlob, `${zipFolderName}.zip`);
            statusSpan.textContent = 'ZIP file is ready for download!';
        } catch (error) {
            console.error('Error generating ZIP:', error);
            alert('Error generating ZIP file. See console for details.');
        }

        resetUI();
    });

    function constructFolderName(creator, eventInput, date, misc) {
        const parts = [];
        if (creator) parts.push(creator);
        if (eventInput) parts.push(eventInput);
        if (date) parts.push(date);
        if (misc) parts.push(misc);
        return parts.join(' - ');
    }

    function constructFileName(creator, eventInput, date, misc, seqNumber, extension) {
        const parts = [];
        if (creator) parts.push(creator);
        if (eventInput) parts.push(eventInput);
        if (date) parts.push(date);
        if (misc) parts.push(misc);
        const baseName = parts.join(' - ');
        return baseName ? `${baseName} -${seqNumber}${extension}` : `File-${seqNumber}${extension}`;
    }

    function resetUI() {
        processButton.disabled = true;
        uploadButton.disabled = false;
        fileInput.disabled = false;
        resetButton.disabled = false;
        progressDiv.style.display = 'none';
        statusSpan.textContent = 'Preparing files...';
        fileList.innerHTML = "";
    }

    resetButton.addEventListener('click', () => {
        document.getElementById('creator').value = '';
        document.getElementById('event').value = '';
        document.getElementById('date').value = '';
        document.getElementById('misc').value = '';
        files = [];
        folderName = "renamed_files";
        uploadedFolderNameDiv.textContent = "";
        processButton.disabled = true;
        fileInput.value = "";
        progressDiv.style.display = 'none';
        warningMessage.style.display = 'none';
        fileList.innerHTML = "";
    });
</script>

</body>
</html>
